# 🖱️ Click Tracker System

---

## 📂 Структура проекта

            ┌──────────────────────────────┐
            │        Frontend              │
            │   click-tracker.js           │
            │   └─ Отслеживает клики       │
            └──────────────┬───────────────┘
                           │ API-запрос
                           ▼
            ┌──────────────────────────────┐
            │          Backend             │
            │        (Laravel App)         │
            └──────────────────────────────┘
                           │
    ┌──────────────────────┼─────────────────────────┐
    ▼                      ▼                         ▼
┌───────────────┐ ┌────────────────┐ ┌────────────────┐
│ Controllers │ │ Services │ │ Repositories │
│ (API/Admin) │ │ (Бизнес-логика)│ │ (Доступ к БД) │
└───────┬───────┘ └──────┬─────────┘ └────────┬───────┘
│ │ │
▼ ▼ ▼
┌──────────────┐ ┌──────────────┐ ┌────────────────┐
│ Requests │ │ Models │ │ Database │
│ (Валидация) │ │ (Click, Site)│ │ (Migrations) │
└──────────────┘ └──────┬───────┘ └────────────────┘
│
▼
┌──────────────┐
│ Views (Blade)│
│ admin/sites │
└──────────────┘
 
 ---
 
 ## 🧩 Компоненты

### click-tracker.js

Скрипт, который подключается на отслеживаемый сайт.  
Он собирает данные о кликах и отправляет их на серверное API.

#### Основная логика:
- Проверяет наличие **токена сайта**
- Отслеживает клики по документу
- Собирает координаты (абсолютные и относительные)
- Определяет **целевой элемент** (тег и классы)
- Формирует `payload` с мета-информацией
- Отправляет данные на API (`/api/clicks`)

#### Собираемые данные:
- Координаты (`page_x`, `page_y`, `pct_x`, `pct_y`, `vp_x`, `vp_y`)
- Размеры области просмотра (`viewport_width`, `viewport_height`)
- Целевой элемент (`target`)
- URL страницы (`url`)
- Временная метка (`clicked_at`)
- Информация о браузере (`user_agent`)
- Токен сайта (`site_token`)

---

### ClickReceiverController

Отвечает за приём и валидацию данных кликов с фронтенда.

#### Функции:
**Валидация**
- Проверяет обязательные поля: `site_token`, `url`, координаты
- Валидирует типы данных (строки, URL, дата, числа)

**Обработка**
- Принимает весь `payload` от трекера
- Передаёт данные в сервисный слой `ClickService`
- Формирует корректный ответ в зависимости от результата

**Ответы API**
- Успех: `201 Created` с `{ ok: true }`
- Ошибка: `403 Forbidden` при невалидном токене

---

### Модель Click

Модель, описывающая структуру данных о кликах.

#### Основные поля:
- `site_id` — связь с сайтом
- `url` — адрес страницы
- `clicked_at` — временная метка (обрабатывается как Carbon-дата)

#### Координаты:
- `page_x`, `page_y` — абсолютные координаты на странице  
- `pct_x`, `pct_y` — относительные координаты в процентах  
- `vp_x`, `vp_y` — координаты относительно viewport  
- `viewport_width`, `viewport_height` — размеры области просмотра

#### Дополнительная информация:
- `target` — целевой элемент (тег и классы)
- `user_agent` — браузер пользователя

#### Особенности:
- Использует `$fillable` для массового присвоения
- Имеет связь `belongsTo(Site::class)`

---

### SiteController

Контроллер для управления сайтами и просмотра статистики.

#### Основные функции:
- **index()** — список всех сайтов  
- **create()** — форма создания сайта  
- **store()** — валидация и создание нового сайта  
- **view()** — просмотр кликов по сайту с фильтрацией по датам

#### Особенности:
- Использует сервисы `SiteService` и `ClickService`
- Форматирует даты через `Carbon`
- Возвращает данные в JSON для отображения тепловой карты

---

### Модель Site

Хранит данные о зарегистрированных сайтах.

#### Основные поля:
- `name` — название сайта  
- `domain` — домен сайта  
- `token` — уникальный токен для идентификации  

#### Автогенерация токена:
- В `boot()` автоматически создаётся 40-символьный токен  
  (`Str::random(40)`)

#### Связи:
- `hasMany(Click::class)` — один сайт может иметь много кликов

#### Безопасность:
- `$fillable` для безопасного массового присвоения
- Токен генерируется автоматически, не зависит от ввода пользователя

---

 
